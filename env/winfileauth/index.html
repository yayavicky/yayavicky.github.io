<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>- Vicky's Notes</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content><meta property="og:description" content="CMD 文件夹权限处理 磁盘分区必须是 NTFS. FAT32不可用。
cacls.exe 修改文件的访问控制表
cacls filename [/T] [/E] [/C] [/G username] [/R user[...]] [/P usererm[...]] [/D user [...]]  cacls filename 显示访问控制列表 ACL T 更改当前目录及所有子目录中指定的文件的 ACL E 编辑 ACL 而非替换 C 出现拒绝访问错误时继续 /G username:perm 赋予指定用户访问权限， perm 表示访问权限，具体为  R 读取 W 写入 C 更改、写入 F 完全控制   /R user 撤销指定用户访问权限，必须与 /E 配合使用 /P user:perm 替换指定用户访问权限， perm 同上，但多 N 选项，即 无 /D user 拒绝指定用户访问  icacls.exe 1. 查看权限 icacls folder_path icacls D:\log D:\log BUILTIN\Administrators:(I)(F) BUILTIN\Administrators:(I)(OI)(CI)(IO)(F) NT AUTHORITY\SYSTEM:(I)(F) NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F) NT AUTHORITY\Authenticated Users:(I)(M) NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(IO)(M) BUILTIN\Users:(I)(RX) BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE) 已成功处理 1 个文件; 处理 0 个文件时失败  注意事项: 对于继承的声明要放到具体权限之前。例如: (OI)(CI)(IO)(M) 是对的，但 (M)(OI)(CI)(IO) 会提示无效的参数。"><meta property="og:type" content="article"><meta property="og:url" content="https://yayavicky.github.io/env/winfileauth/"><meta property="article:section" content="env"><meta itemprop=name content><meta itemprop=description content="CMD 文件夹权限处理 磁盘分区必须是 NTFS. FAT32不可用。
cacls.exe 修改文件的访问控制表
cacls filename [/T] [/E] [/C] [/G username] [/R user[...]] [/P usererm[...]] [/D user [...]]  cacls filename 显示访问控制列表 ACL T 更改当前目录及所有子目录中指定的文件的 ACL E 编辑 ACL 而非替换 C 出现拒绝访问错误时继续 /G username:perm 赋予指定用户访问权限， perm 表示访问权限，具体为  R 读取 W 写入 C 更改、写入 F 完全控制   /R user 撤销指定用户访问权限，必须与 /E 配合使用 /P user:perm 替换指定用户访问权限， perm 同上，但多 N 选项，即 无 /D user 拒绝指定用户访问  icacls.exe 1. 查看权限 icacls folder_path icacls D:\log D:\log BUILTIN\Administrators:(I)(F) BUILTIN\Administrators:(I)(OI)(CI)(IO)(F) NT AUTHORITY\SYSTEM:(I)(F) NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F) NT AUTHORITY\Authenticated Users:(I)(M) NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(IO)(M) BUILTIN\Users:(I)(RX) BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE) 已成功处理 1 个文件; 处理 0 个文件时失败  注意事项: 对于继承的声明要放到具体权限之前。例如: (OI)(CI)(IO)(M) 是对的，但 (M)(OI)(CI)(IO) 会提示无效的参数。"><meta itemprop=wordCount content="852"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="CMD 文件夹权限处理 磁盘分区必须是 NTFS. FAT32不可用。
cacls.exe 修改文件的访问控制表
cacls filename [/T] [/E] [/C] [/G username] [/R user[...]] [/P usererm[...]] [/D user [...]]  cacls filename 显示访问控制列表 ACL T 更改当前目录及所有子目录中指定的文件的 ACL E 编辑 ACL 而非替换 C 出现拒绝访问错误时继续 /G username:perm 赋予指定用户访问权限， perm 表示访问权限，具体为  R 读取 W 写入 C 更改、写入 F 完全控制   /R user 撤销指定用户访问权限，必须与 /E 配合使用 /P user:perm 替换指定用户访问权限， perm 同上，但多 N 选项，即 无 /D user 拒绝指定用户访问  icacls.exe 1. 查看权限 icacls folder_path icacls D:\log D:\log BUILTIN\Administrators:(I)(F) BUILTIN\Administrators:(I)(OI)(CI)(IO)(F) NT AUTHORITY\SYSTEM:(I)(F) NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F) NT AUTHORITY\Authenticated Users:(I)(M) NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(IO)(M) BUILTIN\Users:(I)(RX) BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE) 已成功处理 1 个文件; 处理 0 个文件时失败  注意事项: 对于继承的声明要放到具体权限之前。例如: (OI)(CI)(IO)(M) 是对的，但 (M)(OI)(CI)(IO) 会提示无效的参数。"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title="Vicky's Notes" rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/img/spaw.jpg></div><div class="logo__item logo__text"><div class=logo__title>Vicky's Notes</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/tools/commontools/><span class=menu__text>常用工具</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title></h1><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>vicky</span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#caclsexe><code>cacls.exe</code></a></li><li><a href=#icaclsexe><code>icacls.exe</code></a><ul><li><a href=#1-查看权限>1. 查看权限</a></li><li><a href=#2-授权>2. 授权</a></li><li><a href=#3-删除用户>3. 删除用户</a></li><li><a href=#4-命令汇总>4. 命令汇总</a></li></ul></li><li><a href=#powershell>powershell</a></li><li><a href=#增强工具-xcalsexe>增强工具 <code>xcals.exe</code></a><ul><li><a href=#1-查看文件或文件夹的权限>1. 查看文件或文件夹的权限</a></li><li><a href=#2-替换文件夹中的acl而不确认>2. 替换文件夹中的acl而不确认</a></li><li><a href=#3-赋予某用户对文件夹的控制权限>3. 赋予某用户对文件夹的控制权限</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><h1 id=cmd-文件夹权限处理>CMD 文件夹权限处理</h1><p>磁盘分区必须是 NTFS. FAT32不可用。</p><h2 id=caclsexe><code>cacls.exe</code></h2><p>修改文件的访问控制表</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cacls filename <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/E<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/G username<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/R user<span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span> <span style=color:#f92672>[</span>/P usererm<span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span> <span style=color:#f92672>[</span>/D user <span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span>
</code></pre></div><ul><li><code>cacls filename</code> 显示访问控制列表 ACL</li><li>T 更改当前目录及所有子目录中指定的文件的 ACL</li><li>E 编辑 ACL 而非替换</li><li>C 出现拒绝访问错误时继续</li><li><code>/G username:perm</code> 赋予指定用户访问权限， perm 表示访问权限，具体为<ul><li>R 读取</li><li>W 写入</li><li>C 更改、写入</li><li>F 完全控制</li></ul></li><li><code>/R user</code> 撤销指定用户访问权限，必须与 <code>/E</code> 配合使用</li><li><code>/P user:perm</code> 替换指定用户访问权限， perm 同上，但多 <code>N</code> 选项，即 无</li><li><code>/D user</code> 拒绝指定用户访问</li></ul><h2 id=icaclsexe><code>icacls.exe</code></h2><h3 id=1-查看权限>1. 查看权限</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls folder_path

icacls D:<span style=color:#ae81ff>\l</span>og
D:<span style=color:#ae81ff>\l</span>og BUILTIN<span style=color:#ae81ff>\A</span>dministrators:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
       BUILTIN<span style=color:#ae81ff>\A</span>dministrators:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
       NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
       NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
       NT AUTHORITY<span style=color:#ae81ff>\A</span>uthenticated Users:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span>
       NT AUTHORITY<span style=color:#ae81ff>\A</span>uthenticated Users:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span>
       BUILTIN<span style=color:#ae81ff>\U</span>sers:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span>
       BUILTIN<span style=color:#ae81ff>\U</span>sers:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>GR,GE<span style=color:#f92672>)</span>

已成功处理 <span style=color:#ae81ff>1</span> 个文件; 处理 <span style=color:#ae81ff>0</span> 个文件时失败
</code></pre></div><blockquote><p>注意事项:
　　对于继承的声明要放到具体权限之前。例如: <code>(OI)(CI)(IO)(M)</code> 是对的，但 <code>(M)(OI)(CI)(IO)</code> 会提示无效的参数。</p></blockquote><p>add test user</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>net user username password  /add
net user testabc <span style=color:#ae81ff>123456</span>  /add
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls name /save aclfile <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>
将匹配名称的文件和文件夹的 DACL 存储到 aclfile 中
以便将来与 /restore 一起使用。请注意，未保存 SACL、
所有者或完整性标签。

icacls directory <span style=color:#f92672>[</span>/substitute SidOld SidNew <span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span> /restore aclfile
                 <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>
将存储的 DACL 应用于目录中的文件。
</code></pre></div><h3 id=2-授权>2. 授权</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls D:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /grant username:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span> /T
icacls D:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /grant testabc:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span> /T

<span style=color:#75715e># 所有文件和文件夹</span>
icacls D:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\*</span>.* /grant testabc:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span> /T
</code></pre></div><p>删除部分权限</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 查看权限</span>
icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span>
d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> WIN10-DC1<span style=color:#ae81ff>\t</span>estabc:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\A</span>dministrators:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\A</span>dministrators:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\A</span>uthenticated Users:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\A</span>uthenticated Users:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\U</span>sers:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\U</span>sers:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>GR,GE<span style=color:#f92672>)</span>
          

<span style=color:#75715e># 删除权限</span>
icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /grant<span style=color:#f92672>[</span>:r<span style=color:#f92672>]</span>  testabc:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span> /T
已处理的文件: d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span>
已处理的文件: d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span>2<span style=color:#ae81ff>\w</span>ifi.txt
已成功处理 <span style=color:#ae81ff>2</span> 个文件; 处理 <span style=color:#ae81ff>0</span> 个文件时失败

<span style=color:#75715e># 查看权限</span>
icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span>
d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> WIN10-DC1<span style=color:#ae81ff>\t</span>estabc:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\A</span>dministrators:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\A</span>dministrators:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>F<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\A</span>uthenticated Users:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span>
          NT AUTHORITY<span style=color:#ae81ff>\A</span>uthenticated Users:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\U</span>sers:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>RX<span style=color:#f92672>)</span>
          BUILTIN<span style=color:#ae81ff>\U</span>sers:<span style=color:#f92672>(</span>I<span style=color:#f92672>)(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>IO<span style=color:#f92672>)(</span>GR,GE<span style=color:#f92672>)</span>
</code></pre></div><p><code>/grant[:r] sid:perm</code> 授予指定用户访问权限， 如果使用 <code>:r</code> 将替换以前授予的所有显式权限。</p><p><code>/T</code> 指示在以该名称指定的目录下的所有匹配 文件 或目录 上 执行操作</p><h3 id=3-删除用户>3. 删除用户</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /remove:g testabc /T
</code></pre></div><p><code>/remove[:[g|d]] sid</code> 删除 ACL 中所有出现的SID</p><ul><li><code>:g</code> 将删除授予该 SID 的所有权限</li><li><code>:d</code> 删除拒绝该 SID 的所有权限</li></ul><h3 id=4-命令汇总>4. 命令汇总</h3><h4 id=1-更改所有者>1. 更改所有者</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 更改所有者</span>
icacls file_or_folder /setowner username <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>

icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\3</span><span style=color:#ae81ff>4</span>  /setowner testabc  /T /C /L /Q
</code></pre></div><p>更改所有匹配名称的所有者。该选项不会强制更改所有身份；使用 takeown.exe 实用程序可实现该目的。</p><h4 id=2-查找特定用户权限>2. 查找特定用户权限</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls name /findsid sid  <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>
查找包含显式提及 SID 的 ACL 的所有匹配名称。

icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /findsid testabc  /T /C /L /Q
发现 SID: d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span>2。
发现 SID: d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span>2<span style=color:#ae81ff>\w</span>ifi.txt。
已成功处理 <span style=color:#ae81ff>2</span> 个文件; 处理 <span style=color:#ae81ff>0</span> 个文件时失败
</code></pre></div><h4 id=3-校验>3. 校验</h4><p>查找其 ACL 不规范或长度与 ACE计数不一致的所有文件。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls name /verify <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>

icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /verify  /T /C /L /Q
</code></pre></div><h4 id=4-重置>4. 重置</h4><p>为所有匹配文件使用默认继承的 ACL 替换 ACL。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls name /reset <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>

icacls d:<span style=color:#ae81ff>\l</span>og<span style=color:#ae81ff>\1</span><span style=color:#ae81ff>2</span> /reset  /T /C /L /Q
</code></pre></div><h4 id=5-指定权限>5. 指定权限</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>icacls name <span style=color:#f92672>[</span>/grant<span style=color:#f92672>[</span>:r<span style=color:#f92672>]</span> Sid:perm<span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span>
       <span style=color:#f92672>[</span>/deny Sid:perm <span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span>
       <span style=color:#f92672>[</span>/remove<span style=color:#f92672>[</span>:g|:d<span style=color:#f92672>]]</span> Sid<span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span> <span style=color:#f92672>[</span>/T<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/C<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/L<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>/Q<span style=color:#f92672>]</span>
       <span style=color:#f92672>[</span>/setintegritylevel Level:policy<span style=color:#f92672>[</span>...<span style=color:#f92672>]]</span>
</code></pre></div><ul><li><p><code>/grant[:r] Sid:perm</code> 授予指定的用户访问权限。
如果使用 <code>:r</code>, 这些权限将替换以前授予的所有显式权限。
如果不使用 <code>:r</code>，这些权限将添加到以前授予的所有显式权限。</p></li><li><p><code>/deny Sid:perm</code> 显式拒绝指定的用户访问权限。
将为列出的权限添加显式拒绝 ACE，
并删除所有显式授予的权限中的相同权限。</p></li><li><p><code>/remove[:[g|d]] Sid</code> 显式拒绝指定的用户访问权限。
<code>:g</code>，将删除授予该 SID 的所有权限。
<code>:d</code>，将删除拒绝该 SID 的所有权限。</p></li><li><p><code>/setintegritylevel [(CI)(OI)]</code> 级别将完整性 ACE 显式添加到所有匹配文件。
要指定的级别为以下级别之一:</p><ul><li><p>L[ow]</p></li><li><p>M[edium]</p></li><li><p>H[igh]</p><p>完整性 ACE 的继承选项可以优先于级别，但只应用于目录。</p></li></ul></li><li><p><code>/inheritance:e|d|r</code></p><ul><li><code>e</code> 启用继承</li><li><code>d</code> 禁用继承并复制 ACE</li><li><code>r</code> 删除所有继承的 ACE</li></ul></li></ul><blockquote><p>注意:</p><ul><li>Sid 可以采用数字格式或友好的名称格式。如果给定数字格式，那么请在 SID 的开头添加一个 <code>*</code>。</li><li><code>/T</code> 指示在以该名称指定的目录下的所有匹配文件/目录上执行此操作。</li><li><code>/C</code> 指示此操作将在所有文件错误上继续进行。仍将显示错误消息。</li><li><code>/L</code> 指示此操作在符号链接本身而不是其目标上执行。</li><li><code>/Q</code> 指示 icacls 应该禁止显示成功消息。</li></ul></blockquote><ul><li>ICACLS 保留 ACE 项的规范顺序:<ol><li>显式拒绝</li><li>显式授予</li><li>继承的拒绝</li><li>继承的授予</li></ol></li><li>perm 是权限掩码，可以指定两种格式之一:<ol><li>简单权限序列:<ul><li>N - 无访问权限</li><li>F - 完全访问权限</li><li>M - 修改权限</li><li>RX - 读取和执行权限</li><li>R - 只读权限</li><li>W - 只写权限</li><li>D - 删除权限</li></ul></li><li>在括号中以逗号分隔的特定权限列表:<ul><li>DE - 删除</li><li>RC - 读取控制</li><li>WDAC - 写入 DAC</li><li>WO - 写入所有者</li><li>S - 同步</li><li>AS - 访问系统安全性</li><li>MA - 允许的最大值</li><li>GR - 一般性读取</li><li>GW - 一般性写入</li><li>GE - 一般性执行</li><li>GA - 全为一般性</li><li>RD - 读取数据/列出目录</li><li>WD - 写入数据/添加文件</li><li>AD - 附加数据/添加子目录</li><li>REA - 读取扩展属性</li><li>WEA - 写入扩展属性</li><li>X - 执行/遍历</li><li>DC - 删除子项</li><li>RA - 读取属性</li><li>WA - 写入属性</li></ul></li><li>继承权限可以优先于每种格式，但只应用于
目录:<ul><li><code>(OI)</code> - 对象继承</li><li><code>(CI)</code> - 容器继承</li><li><code>(IO)</code> - 仅继承</li><li><code>(NP)</code> - 不传播继承</li><li><code>(I)</code> - 从父容器继承的权限</li></ul></li></ol></li></ul><h4 id=6-例子>6. 例子</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#75715e># 将 c:\windows 及其子目录下所有文件的 ACL 保存到 AclFile。</span>
icacls c:<span style=color:#ae81ff>\w</span>indows<span style=color:#ae81ff>\*</span> /save AclFile /T

<span style=color:#75715e># 将还原 c:\windows 及其子目录下存在的 AclFile 内所有文件的 ACL。</span>
icacls c:<span style=color:#ae81ff>\w</span>indows<span style=color:#ae81ff>\ </span>/restore AclFile

<span style=color:#75715e># 将授予用户对文件删除和写入 DAC 的管理员权限。</span>
icacls file /grant Administrator:<span style=color:#f92672>(</span>D,WDAC<span style=color:#f92672>)</span>

<span style=color:#75715e># 将授予由 sid S-1-1-0 定义的用户对文件删除和写入 DAC 的权限。</span>
icacls file /grant *S-1-1-0:<span style=color:#f92672>(</span>D,WDAC<span style=color:#f92672>)</span>

<span style=color:#75715e>#递归移除某个文件夹及其子文件夹和文件的Users组权限</span>
icacls.exe D:<span style=color:#ae81ff>\1\ </span>/inheritance:d  <span style=color:#75715e>#关闭目录继承</span>
icacls.exe D:<span style=color:#ae81ff>\1\ </span>/remove:g <span style=color:#e6db74>&#34;Users&#34;</span>  <span style=color:#75715e>#删除Users组权限</span>


icacls D:<span style=color:#ae81ff>\1\ </span> /grant<span style=color:#f92672>[</span>:r<span style=color:#f92672>]</span> username:<span style=color:#f92672>(</span>OI<span style=color:#f92672>)(</span>CI<span style=color:#f92672>)(</span>M<span style=color:#f92672>)</span> /T
</code></pre></div><h2 id=powershell>powershell</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Get-Acl -Path &lt;File or Folder Path&gt; | Format-List
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e># 文件权限</span>
$account = <span style=color:#e6db74>&#34;WINDATA1901\test&#34;</span>
$FileSystemRights = <span style=color:#e6db74>&#34;FullControl&#34;</span>
$objType = <span style=color:#66d9ef>[System.Security.AccessControl.AccessControlType]</span>::Allow
$accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule ($account,$FileSystemRights,$objType)

$Folder = <span style=color:#e6db74>&#34;D:\Test\test.txt&#34;</span>
$acl = Get-Acl $Folder
$acl.SetAccessRule($accessRule)

Set-Acl -Path $Folder -AclObject $acl
</code></pre></div><ul><li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.inheritanceflags?redirectedfrom=MSDN&view=net-6.0">InheritanceFlags Enum - microsoft</a></li><li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.security.accesscontrol.propagationflags?redirectedfrom=MSDN&view=net-6.0">PropagationFlags Enum - microsoft</a></li><li><a href=https://stackoverflow.com/questions/3282656/setting-inheritance-and-propagation-flags-with-set-acl-and-powershell>Setting Inheritance and Propagation flags with set-acl and powershell - stackoverflow</a></li><li>Access Control Entries (ACEs)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>Get-Acl <span style=color:#e6db74>&#34;d:\Test\test01.txt&#34;</span> | Set-Acl -Path <span style=color:#e6db74>&#34;d:\Test\test02.txt&#34;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=color:#75715e># 文件夹权限</span>
$account = <span style=color:#e6db74>&#34;WINDATA1901\test&#34;</span>
$FileSystemRights = <span style=color:#e6db74>&#34;FullControl&#34;</span>
$InheritanceFlag = <span style=color:#66d9ef>[System.Security.AccessControl.InheritanceFlags]</span>::ObjectInherit
$PropagationFlag = <span style=color:#66d9ef>[System.Security.AccessControl.PropagationFlags]</span>::None
$objType = <span style=color:#66d9ef>[System.Security.AccessControl.AccessControlType]</span>::Allow

$accessRule = New-Object System.Security.AccessControl.FileSystemAccessRule ($account,$FileSystemRights,$InheritanceFlag,$PropagationFlag,$objType)

$Folder = <span style=color:#e6db74>&#34;d:\Test\&#34;</span>

$acl = Get-Acl $Folder
$acl.SetAccessRule($accessRule)

Set-Acl -Path $Folder -AclObject $acl
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>PS D:\&gt; (Get-Acl $env:windir).Access | Format-Table -wrap

           FileSystemRights AccessControlType IdentityReference   IsInherited       InheritanceFlags
           ---------------- ----------------- -----------------  -----------       ----------------
                  268435456             Allow CREATOR OWNER       False 		ContainerInherit, ObjectInherit
                  268435456             Allow NT AUTHORITY\SYSTEM  False ContainerInherit, ObjectInherit
        Modify, Synchronize             Allow NT AUTHORITY\SYSTEM                                          False                   None
                  268435456             Allow BUILTIN\Administrators                                       False ContainerInherit, Obje
                                                                                                                              ctInherit
        Modify, Synchronize             Allow BUILTIN\Administrators                                       False                   None
                -1610612736             Allow BUILTIN\Users                                                False ContainerInherit, Obje
                                                                                                                              ctInherit
ReadAndExecute, Synchronize             Allow BUILTIN\Users                                                False                   None
                  268435456             Allow NT SERVICE\TrustedInstaller                                  False       ContainerInherit
                FullControl             Allow NT SERVICE\TrustedInstaller                                  False                   None
ReadAndExecute, Synchronize             Allow APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES       False                   None
                -1610612736             Allow APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES       False ContainerInherit, Obje
                                                                                                                              ctInherit
ReadAndExecute, Synchronize             Allow APPLICATION PACKAGE AUTHORITY\所有受限制的应用程序包         False                   None
                -1610612736             Allow APPLICATION PACKAGE AUTHORITY\所有受限制的应用程序包         False ContainerInherit, Obje
                                                                                                                              ctInherit


</code></pre></div><h2 id=增强工具-xcalsexe>增强工具 <code>xcals.exe</code></h2><p>在windows 2000资源工具包中，微软还提供了一个名为xcacls.exe的文件控制权限修改工具，其功能较cacls.exe更为强大，可以通过命令行设置所有可以在windows资源管理器中访问到的文件系统安全选项，我们可以从[windows - xcacls](http: //www.microsoft.com/windows2000/techinfo/reskit/tools/existing/xcacls-o.asp)下载，安装后即可使用。</p><p>xcacls.exe命令的语法和参数与cacls.exe基本相同，但不同的是它通过显示和修改件的访问控制列表（acl）执行此操作。在“/g”参数后除保持原有的perm权限外，还增加了spec（特殊访问权限)的选项，另外还增加了“/y”的参数，表示禁止在替换用户访问权限时出现确认提示，而默认情况下，cacls.exe是要求确认的，这样在批处理中调用cacls.exe命令时，程序将停止响应并等待输入正确的答案，引入“/y”参数后将可以取消此确认，这样我们就可以在批处理中使用xcacls.exe命令了。</p><h3 id=1-查看文件或文件夹的权限>1. 查看文件或文件夹的权限</h3><p>在“开始→运行”对话框或切换到命令提示符模式下，注意请事先将“c:\program files\resource kit”添加到“系统属性→高级→环境变量→系统变量”中，或者通过cd命令将其设置为当前路径，否则会提示找不到文件，然后键入如下命令：</p><p><code>xcacls C:\ruery</code></p><p>此时，我们会看到图2所示的窗口，这里可以查看到所有用户组或用户对C:\ruery文件夹的访问控制权限，io表示此ace不应用于当前对象，ci表示从属窗口将继承此ace，oi表示从属文件将继承该ace，np表示从属对象不继续传播继承的ace，而每行末尾的字母表示不同级别的权限，</p><ul><li>f表示完全控制.</li><li>c表示更改.</li><li>w表示写入.</li></ul><h3 id=2-替换文件夹中的acl而不确认>2. 替换文件夹中的acl而不确认</h3><p><code>xcacls C:\ruery /g administrator:rw/y</code></p><p>以上命令将替换C:\ruery文件夹中所有文件和文件夹的acl，而不扫描子文件夹，也不会要求用户确认.</p><h3 id=3-赋予某用户对文件夹的控制权限>3. 赋予某用户对文件夹的控制权限</h3><p><code>xcacls h:\temp /g administrator:rwed;rw /e</code></p><p>以上命令将赋予用户ruery对C:\ruery文件夹中所有新建文件的读取、写入、运行和删除权限，但需要说明的是，这条命令只是赋予了用户对文件夹本身的读写权限，而不包括子文件夹下的文件。</p><p>对普通用户来说，cals.exe和xcacls.exe的作用可能不是那么明显，这在windows 2000/xp/server 2003的无人值守安装中特别有用，管理员可以为操作系统所在的文件夹设置初始访问权限；在将软件分发到服务器或工作站时，还可以借助 xcacls.exe提供单步保护，以防止用户误删除文件夹或文件。</p></div></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="vicky avatar" src=/img/cat.jpg class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About vicky</span></div><div class=authorbox__description>.</div></div><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/env/winnetuser/ rel=prev><span class=pager__subtitle>«&#8201;Previous</span><p class=pager__title></p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/env/virtualpc/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title></p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/code/pdfcombine/>Pdf Combine</a> | <a class=footer__link href=/code/python/>Python</a> | <a class=footer__link href=/code/qt5/>Qt5</a></div><div class=footer__copyright>&copy; 2022 © 2021 Vicky's Notes..
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script src=/js/custom.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>
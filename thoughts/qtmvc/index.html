<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>MVC Design and PyQT - Vicky's Notes</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="MVC Design and PyQT"><meta property="og:description" content="资源  MVC design with Qt Designer and PyQt / PySide Why Qt is misusing model/view terminology? Presentation Model Development of Further Patterns of Enterprise Application Architecture GUI Architectures Development of Further Patterns of Enterprise Application Architecture  建议的文件结构 project/ mvc_app.py # main application with App class mvc_app_rc.py # auto-generated resources file (using pyrcc.exe or equivalent) controllers/ main_ctrl.py # main controller with MainController class other_ctrl.py model/ model.py # model with Model class resources/ mvc_app."><meta property="og:type" content="article"><meta property="og:url" content="https://yayavicky.github.io/thoughts/qtmvc/"><meta property="article:section" content="thoughts"><meta property="article:published_time" content="2020-01-31T16:19:21+08:00"><meta property="article:modified_time" content="2020-01-31T16:19:21+08:00"><meta itemprop=name content="MVC Design and PyQT"><meta itemprop=description content="资源  MVC design with Qt Designer and PyQt / PySide Why Qt is misusing model/view terminology? Presentation Model Development of Further Patterns of Enterprise Application Architecture GUI Architectures Development of Further Patterns of Enterprise Application Architecture  建议的文件结构 project/ mvc_app.py # main application with App class mvc_app_rc.py # auto-generated resources file (using pyrcc.exe or equivalent) controllers/ main_ctrl.py # main controller with MainController class other_ctrl.py model/ model.py # model with Model class resources/ mvc_app."><meta itemprop=datePublished content="2020-01-31T16:19:21+08:00"><meta itemprop=dateModified content="2020-01-31T16:19:21+08:00"><meta itemprop=wordCount content="1738"><meta itemprop=keywords content="Thoughts,MVC,PyQT,"><meta name=twitter:card content="summary"><meta name=twitter:title content="MVC Design and PyQT"><meta name=twitter:description content="资源  MVC design with Qt Designer and PyQt / PySide Why Qt is misusing model/view terminology? Presentation Model Development of Further Patterns of Enterprise Application Architecture GUI Architectures Development of Further Patterns of Enterprise Application Architecture  建议的文件结构 project/ mvc_app.py # main application with App class mvc_app_rc.py # auto-generated resources file (using pyrcc.exe or equivalent) controllers/ main_ctrl.py # main controller with MainController class other_ctrl.py model/ model.py # model with Model class resources/ mvc_app."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class="logo logo--mixed"><a class=logo__link href=/ title="Vicky's Notes" rel=home><div class="logo__item logo__imagebox"><img class=logo__img src=/img/spaw.jpg></div><div class="logo__item logo__text"><div class=logo__title>Vicky's Notes</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/tools/commontools/><span class=menu__text>常用工具</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>MVC Design and PyQT</h1><p class=post__lead>MVC Design and PyQT</p><div class="post__meta meta"><div class="meta__item-author meta__item"><svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2.0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class=meta__text>vicky</span></div><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2020-01-31T16:19:21+08:00>2020-01-31</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/mvc/ rel=category>MVC</a>, <a class=meta__link href=/categories/thoughts/ rel=category>Thoughts</a>, <a class=meta__link href=/categories/pyqt/ rel=category>PyQT</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#资源>资源</a></li><li><a href=#建议的文件结构>建议的文件结构</a></li><li><a href=#why-qt-is-misusing-modelview-terminology>Why Qt is misusing model/view terminology?</a></li><li><a href=#short-answer>Short answer</a></li><li><a href=#long-answer>Long answer</a></li></ul></nav></div></div><div class="content post__content clearfix"><h2 id=资源>资源</h2><ul><li><a href=https://stackoverflow.com/questions/26698628/mvc-design-with-qt-designer-and-pyqt-pyside>MVC design with Qt Designer and PyQt / PySide</a></li><li><a href=https://stackoverflow.com/questions/5543198/why-qt-is-misusing-model-view-terminology>Why Qt is misusing model/view terminology?</a></li><li><a href=https://martinfowler.com/eaaDev/PresentationModel.html>Presentation Model</a></li><li><a href=https://martinfowler.com/eaaDev/index.html>Development of Further Patterns of Enterprise Application Architecture</a></li><li><a href=https://martinfowler.com/eaaDev/uiArchs.html>GUI Architectures</a></li><li><a href=https://martinfowler.com/eaaDev/>Development of Further Patterns of Enterprise Application Architecture</a></li></ul><h2 id=建议的文件结构>建议的文件结构</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>project/
    mvc_app.py              <span style=color:#75715e># main application with App class</span>
    mvc_app_rc.py           <span style=color:#75715e># auto-generated resources file (using pyrcc.exe or equivalent)</span>
    controllers/
        main_ctrl.py        <span style=color:#75715e># main controller with MainController class</span>
        other_ctrl.py
    model/
        model.py            <span style=color:#75715e># model with Model class</span>
    resources/
        mvc_app.qrc         <span style=color:#75715e># Qt resources file</span>
        main_view.ui        <span style=color:#75715e># Qt designer files</span>
        other_view.ui
        img/
            icon.png
    views/
        main_view.py        <span style=color:#75715e># main view with MainView class</span>
        main_view_ui.py     <span style=color:#75715e># auto-generated ui file (using pyuic.exe or equivalent)</span>
        other_view.py
        other_view_ui.py
</code></pre></div><h2 id=why-qt-is-misusing-modelview-terminology>Why Qt is misusing model/view terminology?</h2><p>I think that the terminology used in Qt with model/view controls is flawed. On <a href=https://doc.qt.io/qt-5.7/model-view-programming.html>their explanation page</a> they state, that they simplified the MVC to MV by merging View and Controller and they are giving the following picture:</p><p>However I think, they misnamed the roles of objects and I think that,</p><ol><li>What they call View with merged Controller is in fact a View only.</li><li>What they call Model is in fact Controller only.</li><li>If you really want to have a model it would be somewhere where their &ldquo;Data&rdquo; is.</li></ol><p>I am speaking about usual and sane way you would use Qt model/view component in your app. Here are the reasons:</p><ol><li>This is typically Qt component which is used as is, without adding any Controller logic specific to your objects)</li><li>This is hardly a Model, just because you should implement several Qt methods like rowCount, columnCount, data etc. which have nothing to do with your model. In fact there are typical model methods found in Controllers. Of course, you can implement both Controller <strong>and</strong> Model logic here, but first it would be quite bad code design and secondly you would merge Controller and Model not Controller and View as they state.</li><li>As said in reason 2. if you want to separate Model logic that it is surely not the blue box on the picture, but rather the dashed &ldquo;Data&rdquo; box (communicating to real Data of course).</li></ol><p>Is Qt wrong in their terminology, or it is just me who does not understand? (BTW: The reason why it is not academic question is that I have started to code my project following their naming and I have soon found out, that the code clearly is not right. It was only after that when I realized, that I should not try put Model logic in what they call Model)</p><p>In the <a href=http://st-www.cs.illinois.edu/users/smarch/st-docs/mvc.html>original smalltalk paper</a> it says:</p><blockquote><p>The view manages the graphical and/or textual output to the portion of the bitmapped display that is allocated to its application. The controller interprets the mouse and keyboard inputs from the user, commanding the model and/or the view to change as appropriate. Finally, the model manages the behavior and data of the application domain, responds to requests for information about its state (usually from the view), and responds to instructions to change state (usually from the controller).</p></blockquote><p>In light of that I would answer your three main concerns thusly:</p><ol><li>In fact a Qt component &ldquo;manages the graphical [&mldr;] output&rdquo;, and &ldquo;interprets the mouse and keyboard inputs&rdquo;, so it could indeed be called merged View and Controller with respect to the definition above.</li><li>I agree that you are/would be forced to merge Controller and Model (again with respect to the definition above).</li><li>I agree, again. The Model should only manage the data of the <em>application domain</em>. This is what they call &ldquo;data&rdquo;. Clearly, dealing with rows and columns for example has normally nothing to do with our applications domain.</li></ol><p>Where does it leave us? In my opinion, it is best to figure out what Qt really means when the terms &ldquo;Model&rdquo; and &ldquo;View&rdquo; are used and use the terms in their manner while we are programming with Qt. If you keep being bothered it will only slow you down, and the way things are set up in Qt does allow elegant design - which weighs more that their &ldquo;wrong&rdquo; naming conventions.</p><hr><h2 id=short-answer>Short answer</h2><p>Qt&rsquo;s MVC only applies to <strong>one data structure</strong>. When talking about an MVC <strong>application</strong> you should not think about <code>QAbstractItemModel</code> or <code>QListView</code>.</p><p>If you want an MVC architecture for your whole program, Qt hasn&rsquo;t such a &ldquo;huge&rdquo; model/view framework. But for each list / tree of data in your program you can use the Qt MVC approach which indeed has a <strong>controller</strong> within its view. The <strong>data</strong> is within or outside of the model; this depends on what type of model you are using (own model subclass: probably within the model; e.g. QSqlTableModel: outside (but maybe cached within) the model). To put your models and views together, use own classes which then implement the <strong>business logic</strong>.</p><hr><h2 id=long-answer>Long answer</h2><p><em>Qt&rsquo;s model/view approach and terminology:</em></p><p>Qt provides simple <strong>views</strong> for their models. They have a <strong>controller</strong> built in: selecting, editing and moving items are something what in most cases a controller &ldquo;controls&rdquo;. That is, interpreting user input (mouse clicks and moves) and giving the appropriate commands to the model.</p><p>Qt&rsquo;s <strong>models</strong> are indeed models having underlying data. The abstract models of course don&rsquo;t hold data, since Qt doesn&rsquo;t know how you want to store them. But <em>you</em> extend a QAbstractItemModel to your needs by adding your data containers to the subclass and making the model interface accessing your data. So in fact, and I assume you don&rsquo;t like this, the problem is that <em>you</em> need to program the model, so how data is accessed and modified in your data structure.</p><p>In MVC terminology, the model contains both the <strong>data</strong> and the <strong>logic</strong>. In Qt, it&rsquo;s up to you whether or not you include some of your business logic inside your model or put it outside, being a &ldquo;view&rdquo; on its own. It&rsquo;s not even clear what&rsquo;s meant by logic: Selecting, renaming and moving items around? => already implemented. Doing calculations with them? => Put it outside or inside the model subclass. Storing or loading data from/to a file? => Put it inside the model subclass.</p><hr><p><em>My personal opinion:</em></p><p>It is very difficult to provide a good <em>and</em> generic MV(C) system to a programmer. Because in most cases the models are simple (e.g. only string lists) Qt also provides a ready-to-use QStringListModel. But if your data is more complex than strings, it&rsquo;s up to you how you want to represent the data via the Qt model/view interface. If you have, for example, a struct with 3 fields (let&rsquo;s say persons with name, age and gender) you could assign the 3 fields to 3 different columns or to 3 different roles. I dislike both approaches.</p><p>I think Qt&rsquo;s model/view framework is only useful when you want to display <strong>simple data structures</strong>. It becomes difficult to handle if the data is of <strong>custom types</strong> or structured not in a tree or list (e.g. a graph). In most cases, lists are enough and even in some cases, a model should only hold one single entry. Especially if you want to model one single entry having different attributes (one instance of one class), Qt&rsquo;s model/view framework isn&rsquo;t the right way to separate logic from user interface.</p><p>To sum things up, I think Qt&rsquo;s model/view framework is useful if and only if your data is being viewed by one of <strong>Qt&rsquo;s viewer widgets</strong>. It&rsquo;s totally useless if you&rsquo;re about to write your own viewer for a model holding only one entry, e.g. your application&rsquo;s settings, or if your data isn&rsquo;t of printable types.</p><hr><p><em>How did I use Qt model/view within a (bigger) application?</em></p><p>I once wrote (in a team) an application which uses multiple Qt models to manage data. We decided to create a <code>DataRole</code> to hold the actual data which was of a different custom type for each different model subclass. We created an outer model class called <code>Model</code> holding all the different Qt models. We also created an outer view class called <code>View</code> holding the windows (widgets) which are connected to the models within <code>Model</code>. So this approach is an extended Qt MVC, adapted to our own needs. Both <code>Model</code> and <code>View</code> classes themselves don&rsquo;t have anything to do with the Qt MVC.</p><p>Where did we put the <strong>logic</strong>? We created classes which did the actual computations on the data by reading data from source models (when they changed) and writing the results into target models. From Qt&rsquo;s point of view, this logic classes would be views, since they &ldquo;connect&rdquo; to models (not &ldquo;view&rdquo; for the user, but a &ldquo;view&rdquo; for the business logic part of the application).</p><p>Where are the <strong>controllers</strong>? In the original MVC terminology, controllers interpret the user input (mouse and keyboard) and give commands to the model to perform the requested action. Since the Qt views already interpret user input like renaming and moving items, this wasn&rsquo;t needed. But what we needed was an interpretation of user interaction which goes beyond the Qt views.</p><hr><p>No, their &ldquo;model' is definitely not a controller.</p><p>The controller is the part of user visible controls that modify the model (and therefore indirectly modify the view). For example, a &ldquo;delete&rdquo; button is part of the controller.</p><p>I think there is often confusion because many see something like &ldquo;the controller modifies the model&rdquo; and think this means the mutating functions on their model, like a &ldquo;deleteRow()&rdquo; method. But in classic MVC, the controller is specifically the user interface part. Methods that mutate the model are simply part of the model.</p><p>Since MVC was invented, its distinction between controller and view has become increasingly tense. Think about a text box: it both shows you some text and lets you edit it, so is it view or controller? The answer has to be that it is part of both. Back when you were working on a teletype in the 1960s the distinction was clearer – think of the <a href=https://en.m.wikipedia.org/wiki/Ed_(text_editor)><code>ed</code></a> – but that doesn&rsquo;t mean things were better for the user back then!</p><p>It is true that their QAbstractItemModel is rather higher level than a model would normally be. For example, items in it can have a background colour (a brush technically), which is a decidedly view-ish attribute! So there&rsquo;s an argument that QAbstractItemModel is more like a view and your data is the model. The truth is it&rsquo;s somewhere in between the classic meanings of view and model. But I can&rsquo;t see how it&rsquo;s a controller; if anything that&rsquo;s the QT widget that uses it.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/thoughts/ rel=tag>Thoughts</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mvc/ rel=tag>MVC</a></li><li class=tags__item><a class="tags__link btn" href=/tags/pyqt/ rel=tag>PyQT</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="vicky avatar" src=/img/cat.jpg class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About vicky</span></div><div class=authorbox__description>.</div></div><nav class="pager flex"><div class="pager__item pager__item--next"><a class=pager__link href=/thoughts/pythonspeed/ rel=next><span class=pager__subtitle>Next&#8201;»</span><p class=pager__title>Python Speed</p></a></div></nav></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=SEARCH… name=q aria-label=SEARCH…></label>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=https://yayavicky.github.io/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/res/tips/>Tips</a></li><li class=widget__item><a class=widget__link href=/res/svg/>SVG Resource</a></li><li class=widget__item><a class=widget__link href=/tools/commontools/>常用工具</a></li><li class=widget__item><a class=widget__link href=/code/python/>Python</a></li><li class=widget__item><a class=widget__link href=/env/win10fix/>Win10fix</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/code/ title=Code>Code</a>
<a class="widget-taglist__link widget__link btn" href=/tags/coding/ title=coding>coding</a>
<a class="widget-taglist__link widget__link btn" href=/tags/env/ title=Env>Env</a>
<a class="widget-taglist__link widget__link btn" href=/tags/go/ title=GO>GO</a>
<a class="widget-taglist__link widget__link btn" href=/tags/install/ title=Install>Install</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mvc/ title=MVC>MVC</a>
<a class="widget-taglist__link widget__link btn" href=/tags/pyqt/ title=PyQT>PyQT</a>
<a class="widget-taglist__link widget__link btn" href=/tags/resource/ title=Resource>Resource</a>
<a class="widget-taglist__link widget__link btn" href=/tags/script/ title=Script>Script</a>
<a class="widget-taglist__link widget__link btn" href=/tags/setting/ title=Setting>Setting</a>
<a class="widget-taglist__link widget__link btn" href=/tags/system/ title=system>system</a>
<a class="widget-taglist__link widget__link btn" href=/tags/thoughts/ title=Thoughts>Thoughts</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tips/ title=Tips>Tips</a>
<a class="widget-taglist__link widget__link btn" href=/tags/tools/ title=Tools>Tools</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ui/ title=UI>UI</a>
<a class="widget-taglist__link widget__link btn" href=/tags/version/ title=Version>Version</a>
<a class="widget-taglist__link widget__link btn" href=/tags/web/ title=Web>Web</a></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__links><a class=footer__link href=/code/pdfcombine/>Pdf Combine</a> | <a class=footer__link href=/code/python/>Python</a> | <a class=footer__link href=/code/qt5/>Qt5</a></div><div class=footer__copyright>&copy; 2022 © 2021 Vicky's Notes..
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script><script src=/js/custom.js></script></body></html>
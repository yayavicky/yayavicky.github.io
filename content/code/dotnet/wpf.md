---
title: "Wpf"
date: 2022-02-12T16:24:56+08:00
draft: true
---

+ [视频](https://www.zhihu.com/question/368018795)

## 技术前景

从技术角度来说，不考虑跨平台，WPF是Windows平台上目前来说在开发简便性、灵活性、健全度上，最为合适的技术，几乎没有之一。首先，XAML带来的MVVM，好处谁都清楚，而且XAML的书写方式、样式，和HTML非常相似，既方便自己写，也方便别人读；其次，WPF基于.NET，不会像UWP那样有限的API和各种卡脖子的问题；最后，.NET支持C++/CLI，在理论上也是能够支持C++原生项目导入的；而且WPF已经加入.NET Core，将会继续发挥它的作用。

一旦项目考虑了跨平台，你WPF不会是一个选择。大公司会选择使用QT，因为对C++的原生支持能够一了百了，创业公司喜欢使用Web UI。但是对于.NET领域，我们还有Blazor啊。而且.NET Core也有几个开源的UI框架（不过官方没有，而且微软应该不会支持在非Win的桌面环境），并且，还有Xamarin这个神奇的东西（但人家不基于.NET）。

就我对微软的尿性的了解，微软应该会在.NET 5之后，把Xamarin和.NET Core彻底打通，这时候WPF就真的没有前途了，所以问WPF的前途，请关注一下Xamarin~

Windows UI 3 已经在.NET 5支持原生.NET/C++程序了，并且微软宣布UWP的UI将不会继续更新，未来直接使用Windows UI。不过也有局限，就是最低1803，微软一贯的尿性。也就是1803是一个分水岭，如果你的应用需要支持1803以下系统，那么WPF仍然是比较合适的选择（我不觉得XAML islands 这种过渡产品适合使用，更不用说还有Win7）。但是WPF的瓶颈就是在于性能，DX9明显无法满足现代应用的高分辨率高帧率的使用场景，WinUI 2.X可以帮忙解决这个问题，但是从长远角度来说，使用官方全新的UI库才是解决之道。

------

跨平台是WPF死去的原因。因为要跨平台，所以浏览器端成为主流。因为要跨平台，所以QT成为客户端软件主流。因为要跨平台，所以flutter成为移动端主流。因为要跨平台，所以java曾经一度碾轧.net是主流。WPF在windows客户端的表现是完美的。但是，不能跨平台，就等于死亡。在很多年里，微软一直抱着，开源、跨平台，对他有什么好处？这样的巨大疑问，而拒绝让WPF跨平台。然而，Google一次又一次证明微软错了。现在微软也开始拥抱开源、跨平台了。于是，微软打算推出跨平台的WPF，起名叫做：MAUI（跨平台APP的UI）。他使用了WPF的XAML的机制，而且从手机到桌面，跨全平台，实现一个项目，一个UI在所有平台一致。你可以认为这是WPF的进化版，因为它吸收了WPF的优点。但是实际上，它是个新东西，仅仅只是拿走WPF的优点，然后把WPF抛弃。MAUI将在2021年9月提供预览，2021年底随dotnet 6.0一起发布。你学WPF，它的机制，可以帮助你快速上手MAUI。但是，WPF本身，已经被微软自己的MAUI最终淘汰。

---------

使用WPF的大多是设备相关的软件了，由于和设备和用户界面相关，这类公司必然还是使用WPF，我们公司一个大设备，用BS结构去开发，控制复杂设备，BS的开发导致开发复杂度高了太多，可用性太差，所以以后这类项目，肯定还是会用WPF。但是这种项目占比只能越来越少，界面技术，从回报比，绝对不如html或者ios等好




## Web端对比Wpf桌面端的一些劣势

+ [Electron 和当下其他的桌面开发方法相比如何？ - 知乎](https://www.zhihu.com/question/264999651/answer/848101852) 
    - 本文赞同 Electron
+ [WPF+HTML5混合开发](https://blog.csdn.net/z2516305651/article/details/88784349)
    - 环境要求： `.net framework 4.5.2` 以及 和 VC++ 2015 runtime (x86/x64)`, 这两个环境，我是在用Inno Setup 打包的时候通过脚本判断安装的
     C++的运行环境和CefSharp的版本有关，65的版本，最低要求VC++2015
    - [ CefSharp 中文参考文档](https://github.com/cefsharp/CefSharp/wiki/CefSharp%E4%B8%AD%E6%96%87%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3#a1_1)
+ [Windows8 的 WPF 技术与 HTML5 的比较 | AlloyTeam](http://www.alloyteam.com/2012/11/compare-wpf-and-html5-in-windows8-development/)

现在web端成为主流，web端现在流行单页面应用，放浏览器或者程序嵌入webview或者electron随心所欲，似乎很完美。但是对我来说，web端真的是被虐无数，框架难用的事儿就不说了，说几点本质的和桌面端的差距。


1. 渲染性能差，桌面端wpf自己的渲染速度都完爆web，更别提还可以用sharpdx甚至用cpp写个渲染层还能再快，比如我wpf上的chart组件性能完爆echart highchart好几条街，我这里一个折线chart 50w数据点,wpf随便跑个4个8个的，web一个就卡的不要不要了（见最后视频）。还有，我一个win10平板看web基本都卡，跑我写的wpf流畅无压力。我的平板跑office不卡，qq不卡，visualstudio不卡，以uwp为主力不卡，web端随便开点什么都在卡。
2. js也性能差，多线程利用困难，我程序里随手就用c#写个多线程优化下，但是换成js的话写起来就很困难了。
3. 内存限制 v8把js内存限制在2g以下，我一个chart用echart渲染就900m了，三四个必挂。
4. 权限问题 提权困难
5. 互操作问题 比如调第三方给的cpp的dll，比如调com组件，调硬件，串口通信啥的乱七八糟的的，有些人为了一些功能各个浏览器都要买插件还挺贵，这是他做桌面时不会碰到的问题。

用electron启动速度还很慢，而桌面端基本都可以双击即启动

所以web做不了极致，处处会碰壁，只能退而求其次，把界面糊糊好，而wpf性能真的完爆掉web。

我的项目虽然不大，但是动不动就要开好几个tab去监控多个设备，谁让我们擅长的是八连罐呢，甚至支持几组八连罐，30秒采集一次甚至客户会10秒采集一次数据跑十几天，每罐每批次就是我说的50w点数据量，那数据量还得一口气拿出来对比着看，wpf做到无压力了，web端早被我玩坏了，我现在web端很多地方只能用右键新标签打开，否则只有手动在新标签敲url了，这样确保在新进程中打开，分散开不会崩溃，这一招你们需要知道么？大多数人不知道吧，我也是研究了半天，我需要知道，就因为这web端的破限制。

## 跨平台应用开发比较，QT还是Electron

https://zhuanlan.zhihu.com/p/304286970

### 开发技术比较

在技术选择中，我们选中了两个技术路线，一个是基于C++的QT，一个是基于nodejs的electron，我们仔细比价了两个产品的优缺点。

electron |	QT
-- | --
开发简单，上手快速 |	上手慢，但是性能高
适用于一些单一功能的应用开发，一旦项目过大，会有严重的性能问题，适合想要把网页版和桌面端共享代码 | 	较为底层，与系统相关联，全平台兼容性好。适合复杂系统
electron开发的一些应用样例一些大型electron项目，像是atom跟vscode也是主要集中文本处理方面，没有过多的其他功能。|	适用于复杂较为大型的项目开发，像是yy，wps，vituralbox。与硬件相关的复杂系统像是地理信息系统，军工系统
使用JS开发 |	使用C++，绘制界面可以使用QML，标记语言类js
安全性能一般，开发流程短	| 安全性能高，但开发流程长

### 安装包体积比较
我们还去调研使用这两种技术的产品的安装包的体积

electron |	QT
-- | --
atom win版170M mac版183M	|斗鱼直播 win版87M winXP版71M MAC版73.4M
vscode win版59.1M mac版91M|	网易战网客户端 下载器安装 安装包大小不明（安装需要空间390M）
skype win版78.1 mac版105M linuxdeb 80M | 	YY win版74M
github desktop win版96M mac版103M	|  WPS dmg288M app store显示345M win版本150M
飞书 win版247M mac版227M	|  Virtual box win版103M mac版118M ubuntu 84M
Twitch win版83M mac版99M	|  -

### 技术选择

+ qt虽然效率高，但是比较复杂，目前的几个项目功能没有复杂到需要qt不可的程度，electron也能有不错的性能表现。同时qt需要c++的技术栈，公司技术c++技术栈实力也不是很雄厚。
+ 目前针对各平台分别开发应用才能达到最大的性能，公司的一些比较大型的项目也是分平台进行开发，所以不需要额外进行跨平台应用的开发。只有遇到一些工具类型的新app，同时无法分出足够的人手去分平台开发时会考虑。

我们综合考虑了以上的几点，最后选择了electron来进行跨平台应用的开发。